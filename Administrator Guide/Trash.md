垃圾翻译
================
垃圾翻译将允许用户访问已删除或截断文件。每一块砖将保持隐藏的.trashcan 目录，用于存储文件删除或截断从各自的砖。所有这些.trashcan 目录的 aggreagate 可以是 accesed 从装载点。为了避免名称冲突，时间戳追加到原始文件的名称，虽然它被移动到垃圾目录。


# # 含义和用法
除了主用例的访问文件删除或截断，用户，垃圾翻译可以帮助内部的操作，如自我修复和再平衡。在自我修复和再平衡过程中有可能会丢失重要的数据。在这种情况下垃圾翻译可以帮助恢复丢失的数据。垃圾翻译旨在拦截取消链接、 截断和 ftruncate fops 垃圾目录中存储当前文件的一个副本，然后对该原始文件执行 fop。对于内部操作，文件都存储在 'internal_op' 文件夹内垃圾目录下。


# # 卷选项

* * * * gluster 音量设置 &lt; VOLNAME > features.trash &lt; 开 / 关 > * * *

此命令可用于启用垃圾翻译卷中。如果设置为 on，垃圾目录将过程在创建每个砖体积内部卷启动命令。默认情况下译者是卷启动期间加载，但仍然非功能性。禁用此选项的帮助垃圾将不垃圾目录或甚至其内容从卷中删除。


* * * * gluster 音量设置 &lt; VOLNAME > features.trash-迪尔 &lt; 名称 > * * *

使用此命令来重新配置垃圾目录为用户指定的名称。参数是有效的目录名称。将里面每个砖下此名称创建目录。如果不指定用户，垃圾译者将创建垃圾目录具有默认名称".trashcan"。这可以使用仅对垃圾翻译时。


* * * * gluster 音量设置 &lt; VOLNAME > 文件大小 features.trash-马克斯-&lt; 大小 > * * *

此命令可用于筛选文件进入垃圾目录基于它们的大小。直接上面 trash_max_filesize 文件是删除被截断。值的大小可能跟着 mutliplicative 后缀作为 KB （= 1024 个字节），MB (= 1024\ * 1024 个字节) 和 GB (= 1024\ * 1024\ * 1024 字节)。默认大小设置为 5 MB。考虑到这一事实那垃圾目录消耗 glusterfs 卷空间，垃圾功能实施运作方式，它直接删除/截断文件大小 > 1 GB 甚至如果此选项被设置为一些值大于 1 GB。


* * * * gluster 卷设置 &lt; VOLNAME > features.trash-消除-路径 &lt; path1 > [，&lt; path2 >，...]***


可以使用此命令将消除模式设置为垃圾翻译。居住在这种模式下的文件将不会在删除/截断移动垃圾目录。路径必须是有效一本在卷中。


* * * * gluster 音量设置 &lt; VOLNAME > features.trash-内部-op &lt; 开 / 关 > * * *

此命令可用于启用内部的操作，如自我修复和重新平衡的垃圾。默认情况下设置为 off。


# # 使用示例
下面的步骤给说明了一个简单的场景的删除目录中的文件

1.创建一个简单的分发卷和启动它。

# gluster 卷创建测试 rhs: / 首页/砖
# gluster 卷启动测试

2.启用垃圾翻译

# gluster 卷上设置测试 features.trash

3.安装 glusterfs 卷通过本机客户端，如下所示。

# 山-t glusterfs rhs:test 命令

4.创建挂载的目录和文件。

# mkdir 产妇和新生儿破伤风/dir
# 回声 abc > 产妇和新生儿破伤风/目录/文件

5.从山中删除文件。

# rm 产妇和新生儿破伤风/目录/文件-射频

6.里面的垃圾目录签出。

# ls 产妇和新生儿破伤风/.trashcan

我们可以发现里面的垃圾目录已删除的文件时间戳追加对它的文件名。

例如，

[root@rh-host ~] # 装载-t glusterfs rh-主机: / 测试 /mnt/test
[root@rh-host ~] # mkdir /mnt/test/abc
[root@rh-host ~] # 触摸 /mnt/test/abc/file
[root@rh-host ~] # rm /mnt/test/abc/file
删除常规空文件 '/ 产妇和新生儿破伤风/测试/abc/文件' 吗？y

[root@rh-host ~] # ls /mnt/test/abc
[root@rh-host ~] #
[root@rh-host ~] # ls /mnt/test/.trashcan/abc/
file2014-08-21_123400

# # # 必须记住的要点
* 尽快启动卷，垃圾目录将在该卷中创建和装载通过将可见。禁用垃圾不会产生任何影响其从装载的 visibilty。

* 即使删除垃圾目录的不允许的、 目前居住垃圾内容将被删除关于印发关于它删除，只有一个空的垃圾目录存在。

# # # 已知问题
因为垃圾翻译驻留在服务器侧高翻译像空燃比，DHT 不知道重命名和截形操作正在进行的这个翻译，最终将文件移动到垃圾目录。除非并直到完成基于路径查找在垃圾档案来，那些可能从山上作不可见。

