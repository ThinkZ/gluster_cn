管理 GlusterFS 卷快照
==========================

本节介绍如何执行常见的 GlusterFS 卷快照
管理操作

先决条件
=====================

GlusterFS 卷快照功能基于精简调配的 LVM 快照。
要使用快照功能 GlusterFS 卷应履行以下
先决条件︰

* 每个砖应该是独立的精简调配 LVM。
* 砖 LVM 不应包含砖之外的任何其他数据。
* 没有砖应在厚厚的 LVM 上。
* gluster 版本应该是 3.6 及以上。

如何创建薄卷的详细信息可以在以下链接找到。
https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/6/html/Logical_Volume_Manager_Administration/thinly_provisioned_volume_creation.html


快照的几个特点是︰
=============================

* * 崩溃一致性 * *

当快照在特定的时间点，它是确信，
采取的快照是崩溃一致。当还原采取的快照，

然后数据是相同的因为它当时的拍摄快照。


* * 在线快照 * *

当文件系统和其相关联的数据正在拍摄快照
继续可用于客户端。


* * 根据仲裁 * *

仲裁功能可确保该卷是在良好的条件，而砖
是下来。仲裁不满足如果任何砖下来在复制中 n-路在哪里

n < = 2。仲裁遇到 m 砖是上去了，在哪里 m > = （n/2 + 1） 哪里 n 是奇数，

和 m > = n/2，第一块砖是在这里 n 是偶数。快照创建失败

如果不符合法定人数。


* * 障碍 * *

在快照创建一些主席之友被阻止，保证过程中崩溃
一致性。那里是默认超时值为 2 分钟，如果快照创建

未完成的范围内然后主席之友是 unbarried。如果发生了 unbarrier

快照创建完成之前然后快照创建操作
将失败。这确保快照处于一致的状态。




快照管理
=====================


* * 快照创建 * *

语法︰
* gluster 快照创建 <snapname\> <volname\> \[no-timestamp] \[description <description\> \] \[force\]*

详细信息︰
创建 GlusterFS 卷的快照。用户可以提供一个管理单元名称和

要确定管理单元的说明。说明不能超过 1024

个字符。

通过与用户提供的管理单元名称追加时间戳将创建快照。
用户可以通过给没有时间戳国旗覆盖这种行为。

注意︰ 要能够拍摄快照，卷应是现在和它
应处于启动状态。

-----------------------------------------------------------------------------

* * 克隆快照 * *

语法︰
* gluster 快照克隆 <clonename\> <snapname\> *

详细信息︰
创建克隆的快照。成功完成后，新的 GlusterFS

将从快照创建卷。克隆将空间高效的克隆，

即，快照和克隆将共享后端磁盘。

注︰ 要能采取克隆从快照，快照应本
和它应该处于激活状态。

-----------------------------------------------------------------------------

* * 恢复快照 * *

语法︰
* gluster 快照还原 <snapname\> *

详细信息︰
恢复已经采取的 GlusterFS 卷的快照。
快照恢复是脱机的活动因此如果卷是
在线 （在启动状态），则还原操作将失败。

一旦恢复快照它将在中不可用
快照的列表。

---------------------------------------------------------------------------

* * 删除快照 * *

语法︰
* gluster 快照删除 \(all |<snapname\> | 卷 <volname\> \) *


详细信息︰
如果指定了 snapname 然后删除提及的快照。
如果指定了 volname 然后属于特定的所有快照
删除卷。如果关键字 * 全 * 使用然后归属的所有快照

系统将被删除。

--------------------------------------------------------------------------

* * 清单的可用快照 * *

语法︰
* gluster 快照列表 \[volname\]*

详细信息︰
列出所有的快照。
如果 volname 提供，然后只属于快照
列出特定卷。

-------------------------------------------------------------------------

* * 信息的可用快照 * *

语法︰
* gluster 快照信息 \ [\ (snapname | 卷 <volname\> \) \] *

详细信息︰
此命令给出了信息如快照名称、 快照的 UUID，
创建在哪个快照，时间，和管理单元卷名称，下拉列表
已经采取的快照数和仍然可用的快照数
为该特定的卷和快照的状态。

------------------------------------------------------------------------

* * 状态的快照 * *

语法︰
* gluster 快照状态 \ [\ (snapname | 卷 <volname\> \) \] *

详细信息︰
此命令提供了快照的状态。
详情包括快照砖路径，卷组 （LVM 的详细信息），
状态的快照砖，砖，PID 数据百分比为
该组特定卷的快照属于，和总大小
逻辑卷。

如果指定了 snapname 然后显示提到快照的状态。
如果指定了 volname 然后现状属于该卷的所有快照
显示。如果 snapname 和 volname 不是然后指定所有的状态

显示系统中存在的快照。

------------------------------------------------------------------------

* * 配置快照行为 * *

语法︰
* 快照配置 \[volname\] \ (\ [管理单元-马克斯-硬-限制 <count\> \] \[snap-max-soft-limit <percent>\] \)
|\ (\ [自动删除 <enable|disable\> \] \)

|\(\[activate-on-create <enable|disable\>\]\) *


详细信息︰
显示和设置快照配置值。

快照配置没有任何关键字显示快照配置值的
在系统中的所有卷。如果 volname 提供，然后快照配置

该卷的值被显示。

快照配置命令以及关键字可用于更改现行的
配置值。如果 volname 提供然后卷的配置值

改变，否则它将设置/更改了系统限制。

管理单元最大软限制和自动删除是全局选项，将
在系统中的所有卷继承，不能设置为单个卷。

系统限制优先于卷特定的限制。

自动删除功能启用时，然后在到达软限制，
与每个成功的快照创建，将删除最旧的快照。

当自动删除功能被禁用，然后到达了软限制，
用户获取与每个成功的快照创建的警告。

到达硬限制，进一步快照创作将不被允许。

激活上创建默认被禁用的。如果您启用激活--创建，

然后进一步快照期间创建快照的时间将会启动。
-------------------------------------------------------------------------

* * 激活快照 * *

语法︰
* gluster 快照激活 <snapname\> *

详细信息︰
激活所提到的快照。

注意︰ 默认情况下快照已激活快照创建期间。

-------------------------------------------------------------------------

* * 停用快照 * *

语法︰
* gluster 快照停用 <snapname\> *

详细信息︰
停用所述的快照。

-------------------------------------------------------------------------

* * 访问快照 * *

快照可以两种方式激活。

1） 安装快照︰

可以访问快照通过保险丝山 （唯一保险丝）。要做一定要

第一次安装。可以通过以下命令由保险丝安装快照


* 山-t glusterfs <hostname>:/snaps/<snap-name>/<volume-name> <mount-path> *

即说"host1"是贵族之一。让"卷"是卷名称和"我管理单元"

将快照名称。在这种情况下可以通过此命令装载快照


* 山-t glusterfs host1: / 快照/我-管理单元/卷/产妇和新生儿破伤风/快照 *


2） 用户可维护性︰

除了以上方法安装快照，可用的列表
快照和每个快照的内容可以从任何装载
访问 glusterfs 卷 （保险丝或 NFS 或 SMB） 的点。为有

用户可用的快照，它必须首先启用卷。用户

可维护性可以启用为卷要使用以下命令。

* gluster 音量设置 <volname>features.uss 启用 *

一旦启用，从任何目录 （包括文件系统的根）
接入点将创建快照的世界。接入点是隐藏的

目录 cding，会让用户输入快照世界。通过

默认隐藏目录是".snaps"。一旦启用了用户可维护性，

人都不能到 cd 到.snaps 从任何目录。做"ls"的

目录显示快照只不过是目录列表
目前该卷。说，是否有 3 快照 （"snap1"、"snap2"，

"快照 3")，然后做 ls 在.snaps 目录中的将显示为那些 3 姓名
目录条目。他们从哪.snaps 表示状态的目录

是在不同的时间点的输入。

注︰ 对快照的访问是只读。

此外，隐藏的目录 （或快照的访问点的名称
可以改变世界），使用以下命令。

* gluster 音量设置 <volname>快照目录 <new-name> *

3） 从 windows 访问︰
Glusterfs 卷可以由 windows 通过 samba 进行访问。(

samba 的 glusterfs 插件可以帮助实现这一点，而无需重新导出
保险丝安装 glusterfs 中的体积）。Glusterfs 卷的快照可以

也可在 windows 资源管理器中查看。

有 2 种方式︰
* 给入口点目录的路径
(？ <hostname>\ <samba-share> \ <directory>\ < 入口点路径 >) 在运行命令
窗口
* 去 samba 共享通过 windows 资源管理器。使隐藏的文件和文件夹

可见，所以，桑巴舞的根目录中共享一个文件夹图标的入口点
可以看到。

注︰ 从资源管理器中，快照世界可以通过输入只从入口点
samba 共享的根目录。如果快照要从子文件夹，然后

应在运行的命令窗口中提供的路径。

对于快照，可从 windows，下面 2 个选项可以使用。
桑巴舞 A） 的 glusterfs 插件应该给"snapdir-条目-路径"选项
同时开始。该选项是对 glusterfs，指示加载那桑巴

它和选项的值应该被用作路径
用于 windows 共享。
前︰ 说，还有一个 glusterfs 卷和一个名为"出口"目录从
卷的根目录被用作 samba 共享，那么 samba 已加载
使用此选项以及 glusterfs。

ret = glfs_set_xlator_option (fs，"*-snapview-客户端"，
"snapdir-条目-路径"、"进出口");
Xlator 选项"snapdir-条目-路径"是通过卷设置选项，不公开
不能更改从 CLI。它必须是 provded 时的选项

安装 glusterfs 或当桑巴加载 glusterfs。
B） 通过从 windows samba 共享的根目录快照可访问性
是可配置的。默认情况下它处于关闭状态。它是一个卷设置选项，可以

通过 CLI 进行更改。

gluster 音量设置 <volname>features.show 快照目录"开/关"。通过

默认情况下它是关闭。

只有当这两个上面的选项中提供了 （即 snapdir-条目-路径
包含有效的 unix 路径导出和显示快照目录选项
设置为 true)，快照可以通过 windows 资源管理器访问。

如果仅通过 samba 和第二选项设置第一选项 （即 snapdir 条目路径）
（即显示快照目录） 已关闭，然后可以从访问快照
windows 通过运行的命令窗口中，但不是通过资源管理器。


--------------------------------------------------------------------------------------
